<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="logistic_form_template" name="Public Form">
        <form action="/submit_form" method="post" id="transport_order_form" class="logistic-form">
            <input type="hidden" name="token" t-att-value="token"/>
            <table>
                <tr>
                    <td><label>Start Address:</label></td>
                    <td>
                        <t t-if="transport_order.route_start_street">
                            <t t-esc="transport_order.route_start_street"/><br/>
                        </t>
                        <t t-if="transport_order.route_start_street2">
                            <t t-esc="transport_order.route_start_street2"/><br/>
                        </t>
                        <t t-if="transport_order.route_start_city">
                            <t t-esc="transport_order.route_start_city"/><br/>
                        </t>
                        <t t-if="transport_order.route_start_state_id">
                            <t t-esc="transport_order.route_start_state_id.name"/><br/>
                        </t>
                        <t t-if="transport_order.route_start_zip">
                            <t t-esc="transport_order.route_start_zip"/><br/>
                        </t>
                        <t t-if="transport_order.route_start_country_id">
                            <t t-esc="transport_order.route_start_country_id.name"/><br/>
                        </t>
                    </td>
                </tr>

                <tr>
                    <td><label>End Address:</label></td>
                    <td>
                        <t t-if="transport_order.route_end_street">
                            <t t-esc="transport_order.route_end_street"/><br/>
                        </t>
                        <t t-if="transport_order.route_end_street2">
                            <t t-esc="transport_order.route_end_street2"/><br/>
                        </t>
                        <t t-if="transport_order.route_end_city">
                            <t t-esc="transport_order.route_end_city"/><br/>
                        </t>
                        <t t-if="transport_order.route_end_state_id">
                            <t t-esc="transport_order.route_end_state_id.name"/><br/>
                        </t>
                        <t t-if="transport_order.route_end_zip">
                            <t t-esc="transport_order.route_end_zip"/><br/>
                        </t>
                        <t t-if="transport_order.route_end_country_id">
                            <t t-esc="transport_order.route_end_country_id.name"/><br/>
                        </t>
                    </td>
                </tr>

                <tr>
                    <td><label>Number of Containers:</label></td>
                    <td t-esc="transport_order.container_demand"/>
                </tr>

                <tr>
                    <td><label>Additional Details:</label></td>
                    <td t-esc="transport_order.additional_details" placeholder="No Additional Details"/>
                </tr>
            </table>



            <!-- Truck Details Section -->
            <div id="truck_details_section">
                <label>Truck Details:</label><br/>
                <div id="truck_details_container" class='truck-detail'>
                    <!-- Dynamic truck detail entries will be added here -->
                    <button type="button" onclick="addTruckDetail()">Add Truck</button>
                </div>
            </div>

            <!-- Submit Button -->
            <input type="submit" value="Confirm Price"/>

            <footer>
                <div>
                    <label>Exchange Rate:</label>
                    <span type="text" id="exchange_rate_display"/>
                </div>
            </footer>
        </form>
    <script type="text/javascript">
        var nad_to_usd_exchange_rate = <t t-raw="nad_to_usd_exchange_rate"/>;

        function populateExchangeRate() {
            document.getElementById('exchange_rate_display').innerText = `${parseFloat(nad_to_usd_exchange_rate).toFixed(5)} [NAD/USD]`;
        }

        function addTruckDetail() {
            var container = document.getElementById('truck_details_container');
            var truckDetail = document.createElement('div');
            truckDetail.class = 'truck-detail';
            truckDetail.classList.add('truck-detail');
            truckDetail.innerHTML = `
                <input type="text" name="truck_number[]" placeholder="Truck Number"/>
                <input type="text" name="horse_number[]" placeholder="Horse Number"/>
                <input type="text" name="container_number[]" placeholder="Container Number"/>
                <input type="text" name="driver_name[]" placeholder="Driver Name"/>
                <input type="text" name="telephone_number[]" placeholder="Telephone Number"/>
                <input type="number" name="max_load_per_truck[]" placeholder="Max. Load [kg]"/>
                <input type="number" id="priceNad" placeholder="Price in NAD"/>
                <span id="priceUsd" name="product_price[]" style="margin-left: 10px;">0</span><span style="display: inline-block; width: 5px;"/>USD
                <button type="button" onclick="removeTruckDetail(this)">Remove</button>
            `;
            container.appendChild(truckDetail);

            function updateUsdPrice() {
                var nadToUsdRate = <t t-raw="nad_to_usd_exchange_rate"/>; // Fetch the exchange rate
                var nadPrice = document.getElementById('priceNad').value;
                var usdPrice = nadPrice * nadToUsdRate; // Perform the conversion
                <!-- document.getElementById('priceUsd').innerText = `${usdPrice.toFixed(2)} USD`; // Update the display -->
                document.getElementById('priceUsd').innerText = usdPrice.toFixed(2); // Update the display
            }

            // Event listener for the NAD price input
            document.getElementById('priceNad').addEventListener('input', updateUsdPrice);
        }

        function removeTruckDetail(element) {
            element.parentNode.remove();
        }

        // Call these functions to initialize the form
        window.onload = function() {
            populateExchangeRate(); // Populate the exchange rate on load
        };
    </script>
    <style>
        .logistic-form {
            max-width: 800px;
            margin: 0;
            padding: 20px;
            horizontal-align: left;
        }

        .logistic-form table {
            width: 100%;
            border-collapse: collapse;
            horizontal-align: left;
        }

        .logistic-form tr {
            border-bottom: 1px solid #ddd; /* Horizontal border for rows */
            horizontal-align: left;
        }

        .logistic-form td {
            padding: 10px;
            border: 0px solid #ddd;
            vertical-align: top;
        }

        .logistic-form label {
            font-weight: bold;
        }

        .truck-detail {
            margin-top: 15px;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .truck-detail input {
            margin-right: 10px;
        }
        #truck_details_section {
            margin-top: 20px;
        }
        footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px; /* Set the height of your footer */
            background-color: #f5f5f5; /* Background color of footer */
            text-align: center;
            line-height: 60px; /* Center text vertically */
        }
    </style>
    </template>

</odoo>
